$(document).on('ready resize', function() {
    $('.magnific').on('click', function() {
        var caption = $(this).find('.magnific-caption');
        var title = $(this).prop('title');
        if (caption.length) {
            $('.mfp-content').append('<div class="mfp-bottom-bar"><div class="mfp-caption">'+caption.html()+'</div></div>');
        }
        if (title !== '') {
            $('.mfp-content').append('<div class="mfp-bottom-bar"><div class="mfp-title">'+title+'</div></div>');
        }
        if ($(this).prop('href').indexOf('w=') > -1) {
            var width = $(this).prop('href').split('w=')[1];
            $('.mfp-content').css({maxWidth: width+'px'});
        }
    });

    if (window.location.search.indexOf('popupID') > -1) {
        var url = $('#'+window.location.search.split('popupID=')[1]).prop('href');
    }

    $('.magnific.ajax').magnificPopup({ 
        type: 'ajax', 
        closeOnBgClick: true 
    });

    $('.magnific.iframe').magnificPopup({ 
        type: 'iframe',
    });

    $('.magnific.iframe.overlay-mooc').magnificPopup({ 
        type: 'iframe',

        iframe: {
          patterns: {
            vimeo: {
              index: 'vimeo',
              id: '.com/',
              src: '//player.vimeo.com/video/%id%?autoplay=1'
            }
          }
        }
    });

    $('.magnific.image').magnificPopup({ 
        type: 'image', 
        closeOnBgClick: false,
        image: { verticalFit: true }
    });

    $('.magnific.inline').magnificPopup({
        type: 'inline'
    });

    $('.magnific.modal').magnificPopup({
        type: 'inline',
        preloader: false,
        focus: '#username',
        modal: true
    });

    $('.magnific.sourced').magnificPopup({
        type: 'image',
        closeOnBgClick: false,
        image: {
            verticalFit: true,
            titleSrc: function(item) {
                if (typeof item.el.data('url') !== 'undefined' && item.el.data('url') !== '') {
                    //caption text fussing
                    var sourceCaption = '';
                    if (typeof item.el.data('caption') !== 'undefined' && item.el.data('caption') !== '') {
                        sourceCaption = item.el.data('caption');
                    } else {
                        sourceCaption = 'Source';
                    }

                    return '<div class="text-align-c"><a class="chevron-after" href="' + item.el.data('url') + '" title="' + item.el.data('url') + '" target="_blank">' + sourceCaption + '</a></div>';
                }
            }
        }
    });

    $('.magnific-images').magnificPopup({
        delegate: 'a',
        type: 'image',
        tLoading: 'Loading image #%curr%...',
        mainClass: 'magnific-images',
        gallery: {
            enabled: true,
            navigateByImgClick: true,
            preload: [0,1] // Will preload 0 - before current, and 1 after the current image
        },
        image: {
            tError: '<a href="%url%">The image #%curr%</a> could not be loaded.',
            titleSrc: function(item) {
                return item.el.attr('title');
            }
        }
    });

    $(document).on('click', '.popup-modal-dismiss', function(e) {
        e.preventDefault();
        $.magnificPopup.close();
    });
});